-- 國三數學上學期：章節與題型（依技能樹建立）
-- 章節 ID 規則：m3-{章}-{節}-{單元}
-- 題型 ID 規則：{chapter_id}-{序號}（序號對應 S01=1, S02=2...）
-- 題型代碼：S01, S02, ...

-- 1) 章節
INSERT INTO chapters (id, title, sort_order, is_active, grade_id, term)
VALUES
  ('m3-5-1-1', '連比例', 1, true, 'J3-MATH', 'upper'),
  ('m3-5-1-2', '比例線段', 2, true, 'J3-MATH', 'upper'),
  ('m3-5-1-3', '縮放與相似', 3, true, 'J3-MATH', 'upper'),
  ('m3-5-1-4', '相似三角形的應用', 4, true, 'J3-MATH', 'upper'),
  ('m3-5-2-1', '點、直線與圓之間的位置關係', 5, true, 'J3-MATH', 'upper'),
  ('m3-5-2-2', '圓心角、圓周角與弧的關係', 6, true, 'J3-MATH', 'upper'),
  ('m3-5-3-1', '證明與推理', 7, true, 'J3-MATH', 'upper'),
  ('m3-5-3-2', '三角形的外心、內心與重心', 8, true, 'J3-MATH', 'upper')
ON CONFLICT (id) DO UPDATE SET
  title = EXCLUDED.title,
  sort_order = EXCLUDED.sort_order,
  is_active = EXCLUDED.is_active,
  grade_id = EXCLUDED.grade_id,
  term = EXCLUDED.term;

-- 2) 題型（依技能樹）
INSERT INTO question_types (id, chapter_id, name, code, description, sort_order, is_active)
VALUES
  -- 5-1-1 連比例
  ('m3-5-1-1-1', 'm3-5-1-1', '連比的意義', 'S01', '理解連比是「三個以上數量之間的比例關係」；能將連比表示為 a:b:c 的形式；知道連比可視為多個比例的連續組合', 1, true),
  ('m3-5-1-1-2', 'm3-5-1-1', '連比例的基本性質', 'S02', '理解連比例中，各比例間的比值相等；能從連比中找出共同的比例關係', 2, true),
  ('m3-5-1-1-3', 'm3-5-1-1', '建立連比例式', 'S03', '能將文字敘述轉換為連比例式；能正確設定未知數表示比例關係', 3, true),
  ('m3-5-1-1-4', 'm3-5-1-1', '由連比例求實際數值', 'S04', '能利用總量或已知條件求出各部分實際值；能正確使用「比例 × 倍數」的方法', 4, true),
  ('m3-5-1-1-5', 'm3-5-1-1', '連比例的生活應用', 'S05', '能將連比例應用於分配、混合、比例分工問題；能解決實際情境中的多量比例分配', 5, true),
  ('m3-5-1-1-6', 'm3-5-1-1', '連比例綜合題', 'S06', '能結合連比例與其他比例概念（如單位量、倍數）；能處理多條件的連比例問題', 6, true),

  -- 5-1-2 比例線段
  ('m3-5-1-2-1', 'm3-5-1-2', '比例線段的基本概念', 'S01', '理解「比例線段」是由平行線所截出的對應線段；能辨認哪些線段彼此成比例', 1, true),
  ('m3-5-1-2-2', 'm3-5-1-2', '平行線截線段成比例的性質', 'S02', '理解：若數條平行線截兩條直線，則對應線段成比例；能正確寫出比例式', 2, true),
  ('m3-5-1-2-3', 'm3-5-1-2', '建立比例線段的比例式', 'S03', '能依圖形正確找出對應線段；能列出正確比例式解題', 3, true),
  ('m3-5-1-2-4', 'm3-5-1-2', '利用比例線段求未知長', 'S04', '能利用比例式計算未知線段長；能處理含未知數的比例問題', 4, true),
  ('m3-5-1-2-5', 'm3-5-1-2', '比例線段的幾何應用', 'S05', '能將比例線段應用於三角形、梯形等圖形；能解決圖形中的比例分割問題', 5, true),
  ('m3-5-1-2-6', 'm3-5-1-2', '比例線段綜合題', 'S06', '能結合比例線段與其他比例、相似概念解題；能處理多條件幾何比例問題', 6, true),

  -- 5-1-3 縮放與相似
  ('m3-5-1-3-1', 'm3-5-1-3', '縮放圖形的意義', 'S01', '理解縮放是指圖形在形狀不變下，依固定比例放大或縮小；能分辨放大（比例 > 1）與縮小（0 < 比例 < 1）', 1, true),
  ('m3-5-1-3-2', 'm3-5-1-3', '相似圖形的基本概念', 'S02', '理解相似圖形具有對應角相等、對應邊成比例；能辨認兩圖形是否相似', 2, true),
  ('m3-5-1-3-3', 'm3-5-1-3', '相似三角形的判別性質', 'S03', '能使用相似三角形判別方式：AA、SAS、SSS', 3, true),
  ('m3-5-1-3-4', 'm3-5-1-3', '建立縮放比例', 'S04', '能從題目或圖形中找出縮放比例；能正確計算縮放後的邊長', 4, true),
  ('m3-5-1-3-5', 'm3-5-1-3', '利用相似性質求未知量', 'S05', '能利用相似三角形建立比例式，解未知邊長或高度', 5, true),
  ('m3-5-1-3-6', 'm3-5-1-3', '相似圖形的生活應用', 'S06', '能將相似概念應用於地圖比例、模型縮放；能處理實際比例換算問題', 6, true),
  ('m3-5-1-3-7', 'm3-5-1-3', '相似的綜合題', 'S07', '能結合比例線段、平行線與相似概念解題；能處理多步驟幾何題', 7, true),

  -- 5-1-4 相似三角形的應用
  ('m3-5-1-4-1', 'm3-5-1-4', '相似三角形應用概念', 'S01', '理解相似三角形可用於間接測量與比例推算；知道對應邊成比例是應用基礎', 1, true),
  ('m3-5-1-4-2', 'm3-5-1-4', '建立相似三角形比例式', 'S02', '能依圖形或情境建立相似三角形；正確列出對應邊的比例式', 2, true),
  ('m3-5-1-4-3', 'm3-5-1-4', '利用比例求實際長度', 'S03', '能利用相似比例計算未知高度、距離或長度', 3, true),
  ('m3-5-1-4-4', 'm3-5-1-4', '生活情境測量問題', 'S04', '能解決生活中的高度、距離測量問題，如影子法、比例尺', 4, true),
  ('m3-5-1-4-5', 'm3-5-1-4', '相似三角形綜合題', 'S05', '能處理多步驟、跨概念的相似三角形應用題', 5, true),

  -- 5-2-1 點、直線與圓之間的位置關係
  ('m3-5-2-1-1', 'm3-5-2-1', '圓的基本概念', 'S01', '理解圓是由「與圓心距離相等的所有點」所形成的圖形；能分辨圓心、半徑、直徑', 1, true),
  ('m3-5-2-1-2', 'm3-5-2-1', '點與圓的位置關係', 'S02', '能依「點到圓心距離」與「半徑」比較，判斷點在圓內、圓上、圓外', 2, true),
  ('m3-5-2-1-3', 'm3-5-2-1', '直線與圓的位置關係', 'S03', '能依直線與圓的交點數判斷為割線（兩交點）、切線（一交點）、不相交（零交點）', 3, true),
  ('m3-5-2-1-4', 'm3-5-2-1', '切線的性質', 'S04', '理解圓的切線與半徑在切點處垂直；能利用此性質解題或作圖', 4, true),
  ('m3-5-2-1-5', 'm3-5-2-1', '弦與弦心距的關係', 'S05', '理解弦越長弦心距越短；等長弦弦心距相等；能由弦心距比較弦長或反向推論', 5, true),
  ('m3-5-2-1-6', 'm3-5-2-1', '利用距離判斷位置關係', 'S06', '能利用距離計算（如座標、尺規）判斷點或直線與圓的關係', 6, true),
  ('m3-5-2-1-7', 'm3-5-2-1', '作切線與相關作圖', 'S07', '能利用圓心與半徑作切線；能說明作圖原理', 7, true),
  ('m3-5-2-1-8', 'm3-5-2-1', '圓與位置關係的綜合題', 'S08', '能結合點、直線與圓的位置關係解題；能處理多條件幾何問題', 8, true),

  -- 5-2-2 圓心角、圓周角與弧的關係
  ('m3-5-2-2-1', 'm3-5-2-2', '圓心角的意義', 'S01', '理解圓心角是以圓心為頂點、兩邊為半徑所形成的角；能辨認對應的弧', 1, true),
  ('m3-5-2-2-2', 'm3-5-2-2', '圓周角的意義', 'S02', '理解圓周角是頂點在圓周上、兩邊為弦的角；能辨認其所對的弧', 2, true),
  ('m3-5-2-2-3', 'm3-5-2-2', '圓心角與圓周角的關係', 'S03', '理解同弧所對的圓心角是圓周角的 2 倍', 3, true),
  ('m3-5-2-2-4', 'm3-5-2-2', '弧與角度的關係', 'S04', '理解弧的大小可用對應圓心角表示；能由弧推角或由角推弧', 4, true),
  ('m3-5-2-2-5', 'm3-5-2-2', '利用角弧關係計算角度', 'S05', '能利用圓心角與圓周角關係計算未知角度', 5, true),
  ('m3-5-2-2-6', 'm3-5-2-2', '同弧圓周角的性質', 'S06', '理解同弧所對的圓周角相等；能用於證明或計算', 6, true),
  ('m3-5-2-2-7', 'm3-5-2-2', '圓角關係的綜合應用', 'S07', '能結合多個角與弧關係解題，處理複合圖形', 7, true),

  -- 5-3-1 證明與推理
  ('m3-5-3-1-1', 'm3-5-3-1', '證明的基本概念', 'S01', '理解「證明」是利用已知條件與定理推導結論的過程；理解證明需具備條件、推理過程與結論', 1, true),
  ('m3-5-3-1-2', 'm3-5-3-1', '幾何證明的特性', 'S02', '理解幾何證明依賴圖形、性質與定理（如全等、平行線性質、圓性質等）；能分辨證明中可用的依據', 2, true),
  ('m3-5-3-1-3', 'm3-5-3-1', '代數證明的特性', 'S03', '理解代數證明透過等量關係與式子運算推導結論；能分辨等式變形是否合法', 3, true),
  ('m3-5-3-1-4', 'm3-5-3-1', '幾何證明的基本流程', 'S04', '能依序進行：1) 標示已知條件 2) 標出欲證結論 3) 逐步引用性質/定理推導；能維持推理順序清楚', 4, true),
  ('m3-5-3-1-5', 'm3-5-3-1', '代數證明的推理流程', 'S05', '能由已知條件列出等式；能進行合法的等式變形推導結論；能檢查每一步是否等價', 5, true),
  ('m3-5-3-1-6', 'm3-5-3-1', '幾何證明的綜合應用', 'S06', '能結合多個幾何性質完成完整證明；能處理多步驟的證明題（如平行四邊形性質、全等/相似推論）', 6, true),
  ('m3-5-3-1-7', 'm3-5-3-1', '代數證明的應用與反思', 'S07', '能檢查證明是否涵蓋所有情況；能判斷證明是否嚴謹（是否排除例外、是否等價推導）', 7, true),

  -- 5-3-2 三角形的外心、內心與重心
  ('m3-5-3-2-1', 'm3-5-3-2', '三角形外心的意義', 'S01', '理解外心是「三邊的中垂線交點」；理解外心到三個頂點距離相等；能分辨外心在銳角、直角、鈍角三角形中的位置', 1, true),
  ('m3-5-3-2-2', 'm3-5-3-2', '三角形內心的意義', 'S02', '理解內心是「三角形三內角角平分線的交點」；理解內心到三邊距離相等；理解內心一定位於三角形內部', 2, true),
  ('m3-5-3-2-3', 'm3-5-3-2', '三角形重心的意義', 'S03', '理解重心是「三條中線的交點」；理解重心將每條中線分成 2:1；理解重心位置不受三角形種類影響', 3, true),
  ('m3-5-3-2-4', 'm3-5-3-2', '作外心、內心與重心', 'S04', '能利用尺規作出：外心（作兩邊中垂線）、內心（作兩角平分線）、重心（作兩條中線）', 4, true),
  ('m3-5-3-2-5', 'm3-5-3-2', '利用性質進行距離或比例計算', 'S05', '能利用外心、內心、重心的性質求距離或比例；能結合代數式解題', 5, true),
  ('m3-5-3-2-6', 'm3-5-3-2', '三種中心的比較與判別', 'S06', '能比較外心、內心、重心在位置與性質上的差異；能由題目條件判斷所需使用的中心', 6, true),
  ('m3-5-3-2-7', 'm3-5-3-2', '三角形中心的綜合應用題', 'S07', '能結合多種中心性質解題；能處理多步驟幾何題或證明題', 7, true)
ON CONFLICT (id) DO UPDATE SET
  chapter_id = EXCLUDED.chapter_id,
  name = EXCLUDED.name,
  code = EXCLUDED.code,
  description = EXCLUDED.description,
  sort_order = EXCLUDED.sort_order,
  is_active = EXCLUDED.is_active;

