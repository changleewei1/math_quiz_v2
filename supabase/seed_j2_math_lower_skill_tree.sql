-- 國二數學下學期：章節與題型（依技能樹建立）
-- 章節 ID 規則：m2-{章}-{節}-l（加上 -l 避免與上學期重複）
-- 題型 ID 規則：{chapter_id}-{序號}（序號對應 S01=1, S02=2...）
-- 題型代碼：S01, S02, ...
-- 注意：description 會填入 Skill Detail

-- 1) 章節
INSERT INTO chapters (id, title, sort_order, is_active, grade_id, term)
VALUES
  ('m2-1-1-l', '等差數列', 1, true, 'J2-MATH', 'lower'),
  ('m2-1-2-l', '等差級數', 2, true, 'J2-MATH', 'lower'),
  ('m2-1-3-l', '等比數列', 3, true, 'J2-MATH', 'lower'),
  ('m2-2-1-l', '函數與函數圖形', 4, true, 'J2-MATH', 'lower'),
  ('m2-3-1-l', '三角形與多邊形的內角與外角', 5, true, 'J2-MATH', 'lower'),
  ('m2-3-2-l', '尺規作圖', 6, true, 'J2-MATH', 'lower'),
  ('m2-3-3-l', '三角形的全等性質', 7, true, 'J2-MATH', 'lower'),
  ('m2-3-4-l', '中垂線與角平分線的性質', 8, true, 'J2-MATH', 'lower'),
  ('m2-3-5-l', '三角形的邊角關係', 9, true, 'J2-MATH', 'lower'),
  ('m2-4-1-l', '平行', 10, true, 'J2-MATH', 'lower'),
  ('m2-4-2-l', '平行四邊形', 11, true, 'J2-MATH', 'lower'),
  ('m2-4-3-l', '特殊四邊形的性質', 12, true, 'J2-MATH', 'lower')
ON CONFLICT (id) DO UPDATE SET
  title = EXCLUDED.title,
  sort_order = EXCLUDED.sort_order,
  is_active = EXCLUDED.is_active,
  grade_id = EXCLUDED.grade_id,
  term = EXCLUDED.term;

-- 2) 題型（依技能樹）
INSERT INTO question_types (id, chapter_id, name, code, description, sort_order, is_active)
VALUES
  -- 1-1 等差數列
  ('m2-1-1-l-1', 'm2-1-1-l', '認識數列', 'S01', '理解數列是一串依規則排列的數；能辨認項與項次，會用 a₁,a₂,… 表示。', 1, true),
  ('m2-1-1-l-2', 'm2-1-1-l', '等差數列的定義', 'S02', '理解相鄰兩項的差相等即為等差數列；能說明公差 d 的意義。', 2, true),
  ('m2-1-1-l-3', 'm2-1-1-l', '公差 d 的求法與意義', 'S03', '理解 d=a₂−a₁；能由任兩相鄰項求 d；知道 d 可為正、負或 0。', 3, true),
  ('m2-1-1-l-4', 'm2-1-1-l', '判斷是否為等差數列', 'S04', '能逐項相減檢驗差是否固定；能排除非等差數列。', 4, true),
  ('m2-1-1-l-5', 'm2-1-1-l', '第 n 項公式運用', 'S05', '理解並能使用 aₙ=a₁+(n−1)d；能正確代入 a₁、d、n。', 5, true),
  ('m2-1-1-l-6', 'm2-1-1-l', '等差中項', 'S06', '理解等差中項=前後兩項的平均 (a+b)/2；能判斷三項是否成等差。', 6, true),
  ('m2-1-1-l-7', 'm2-1-1-l', '等差數列文字應用題建模', 'S07', '能把「每天多…」「每次增加固定量」轉為等差數列；能判斷已知是 a₁、d 或 aₙ。', 7, true),
  ('m2-1-1-l-8', 'm2-1-1-l', '反推等差數列參數', 'S08', '能由兩個項次反推 d 或 a₁；能處理已知 a₅、a₁₀ 這類反向題。', 8, true),

  -- 1-2 等差級數
  ('m2-1-2-l-1', 'm2-1-2-l', '等差級數的意義', 'S01', '理解等差級數是等差數列前 n 項的總和，用 Sₙ 表示；能分辨 aₙ(第n項) 與 Sₙ(前n項和)。', 1, true),
  ('m2-1-2-l-2', 'm2-1-2-l', 'Sₙ 的表示法', 'S02', '理解 Sₙ=a₁+a₂+…+aₙ；能把題目文字轉成 Sₙ 的意義。', 2, true),
  ('m2-1-2-l-3', 'm2-1-2-l', '等差級數求和公式', 'S03', '能使用 Sₙ= n(a₁+aₙ)/2；理解首尾配對概念。', 3, true),
  ('m2-1-2-l-4', 'm2-1-2-l', '由 a₁、d、n 求 Sₙ', 'S04', '能先用 aₙ=a₁+(n−1)d 求出 aₙ，再代入求 Sₙ；流程清楚。', 4, true),
  ('m2-1-2-l-5', 'm2-1-2-l', '等差級數應用問題', 'S05', '能把存錢、排座位、樓梯等「每次固定增加」情境建模為等差級數。', 5, true),
  ('m2-1-2-l-6', 'm2-1-2-l', '等差級數反推問題', 'S06', '能由 Sₙ 反推 n 或 d，會設未知數列式解題。', 6, true),

  -- 1-3 等比數列
  ('m2-1-3-l-1', 'm2-1-3-l', '認識等比數列', 'S01', '理解等比數列相鄰兩項比值固定；能分辨等差(差固定)與等比(比固定)。', 1, true),
  ('m2-1-3-l-2', 'm2-1-3-l', '公比 r 的求法與意義', 'S02', '理解 r=a₂/a₁；能由相鄰項求 r；知道 r 可為負或分數。', 2, true),
  ('m2-1-3-l-3', 'm2-1-3-l', '判斷是否為等比數列', 'S03', '能逐項相除檢驗比值是否固定；能處理含 0 的特殊情況(不可除)。', 3, true),
  ('m2-1-3-l-4', 'm2-1-3-l', '第 n 項公式運用', 'S04', '能使用 aₙ=a₁·r^(n−1)；代入與指數運算正確。', 4, true),
  ('m2-1-3-l-5', 'm2-1-3-l', '等比中項', 'S05', '理解等比中項=√(ab)；能判斷三項是否成等比。', 5, true),
  ('m2-1-3-l-6', 'm2-1-3-l', '等比數列應用題建模', 'S06', '能把倍增倍減、成長率/折舊等情境建模為等比數列；正確找出公比。', 6, true),
  ('m2-1-3-l-7', 'm2-1-3-l', '反推等比數列參數', 'S07', '能由兩個項次反推 r 或 a₁，能處理指數關係(如 a₆/a₃=r³)。', 7, true),

  -- 2-1 函數與函數圖形
  ('m2-2-1-l-1', 'm2-2-1-l', '函數概念(唯一對應)', 'S01', '理解函數為「每個 x 對應唯一 y」的對應關係；用輸入→輸出理解。', 1, true),
  ('m2-2-1-l-2', 'm2-2-1-l', '函數表示法轉換', 'S02', '理解函數可用表格、代數式、圖形表示；能在表示法間轉換。', 2, true),
  ('m2-2-1-l-3', 'm2-2-1-l', '求函數值', 'S03', '能將指定 x 代入函數式求 y；能處理負數、0，注意括號與運算順序。', 3, true),
  ('m2-2-1-l-4', 'm2-2-1-l', '繪製函數圖形', 'S04', '能取多組 x 求 y 得點；在座標平面標點並連成圖形(一次函數為直線)。', 4, true),
  ('m2-2-1-l-5', 'm2-2-1-l', '由圖判斷是否為函數(垂直線測試)', 'S05', '能用「垂直線測試」判斷圖形是否為函數；理解為何圓不是函數。', 5, true),
  ('m2-2-1-l-6', 'm2-2-1-l', '情境建模為函數', 'S06', '能定義自變數/應變數並建立式子；能解釋參數意義與趨勢。', 6, true),

  -- 3-1 三角形與多邊形的內角與外角
  ('m2-3-1-l-1', 'm2-3-1-l', '角的分類', 'S01', '能辨認銳角、直角、鈍角、平角、周角；理解角度大小與形狀關係。', 1, true),
  ('m2-3-1-l-2', 'm2-3-1-l', '兩角關係', 'S02', '理解對頂角相等、互補角(和90°)、補角(和180°)；能辨認角型。', 2, true),
  ('m2-3-1-l-3', 'm2-3-1-l', '三角形內角和', 'S03', '理解三角形內角和為180°；能由兩角求第三角。', 3, true),
  ('m2-3-1-l-4', 'm2-3-1-l', '三角形外角定理', 'S04', '理解外角=兩個不相鄰內角和；能用外角求內角。', 4, true),
  ('m2-3-1-l-5', 'm2-3-1-l', 'n邊形內角和', 'S05', '理解可分成(n−2)個三角形；能用內角和=(n−2)×180°。', 5, true),
  ('m2-3-1-l-6', 'm2-3-1-l', '正多邊形的內外角', 'S06', '能求正n邊形單一內角與外角；理解外角和為360°。', 6, true),
  ('m2-3-1-l-7', 'm2-3-1-l', '綜合角度應用', 'S07', '能結合角關係與多邊形性質解題；能由外角反推邊數等。', 7, true),

  -- 3-2 尺規作圖
  ('m2-3-2-l-1', 'm2-3-2-l', '尺規作圖原則', 'S01', '理解只能用無刻度直尺與圓規；作圖重點在幾何性質而非測量。', 1, true),
  ('m2-3-2-l-2', 'm2-3-2-l', '作等線段', 'S02', '能固定圓規開口複製線段長度，作出等長線段。', 2, true),
  ('m2-3-2-l-3', 'm2-3-2-l', '作等角', 'S03', '能用弧線與交點複製角度；作圖順序正確。', 3, true),
  ('m2-3-2-l-4', 'm2-3-2-l', '作中垂線', 'S04', '能用兩圓弧交點連線作中垂線；理解其距離性質。', 4, true),
  ('m2-3-2-l-5', 'm2-3-2-l', '作角平分線', 'S05', '能用弧線交點作角平分線；平分線通過角頂點。', 5, true),
  ('m2-3-2-l-6', 'm2-3-2-l', '尺規作圖綜合應用', 'S06', '能結合等線段、等角、中垂線、角平分線完成複合作圖並說明理由。', 6, true),

  -- 3-3 三角形的全等性質
  ('m2-3-3-l-1', 'm2-3-3-l', '全等的意義', 'S01', '理解全等=形狀與大小完全相同，可平移/旋轉/翻轉重合；全等≠相似。', 1, true),
  ('m2-3-3-l-2', 'm2-3-3-l', '對應關係', 'S02', '理解全等需正確對應頂點、邊、角；能正確寫 △ABC≅△DEF 的對應。', 2, true),
  ('m2-3-3-l-3', 'm2-3-3-l', '全等判定條件', 'S03', '會用 SSS、SAS(夾角)、ASA/AAS 判定；理解 AAA 不能判全等。', 3, true),
  ('m2-3-3-l-4', 'm2-3-3-l', '由標記判定全等並寫理由', 'S04', '能從刻痕/角弧等標記讀出條件，寫出完整判定理由。', 4, true),
  ('m2-3-3-l-5', 'm2-3-3-l', '全等推論邊角相等', 'S05', '能先證全等，再推對應邊相等/對應角相等求未知量。', 5, true),
  ('m2-3-3-l-6', 'm2-3-3-l', '全等在幾何證明中的應用', 'S06', '能加入輔助線並用全等完成證明(如等腰三角形底角相等)。', 6, true),

  -- 3-4 中垂線與角平分線的性質
  ('m2-3-4-l-1', 'm2-3-4-l', '中垂線的定義與性質', 'S01', '理解中垂線=通過中點且垂直於線段；中垂線上點到兩端距離相等。', 1, true),
  ('m2-3-4-l-2', 'm2-3-4-l', '角平分線的定義與性質', 'S02', '理解角平分線把角分成兩個相等角；角平分線上點到兩邊的垂直距離相等。', 2, true),
  ('m2-3-4-l-3', 'm2-3-4-l', '用中垂線性質解題', 'S03', '能由 PA=PB 判斷 P 在 AB 的中垂線上(或反推)；能處理反向推論。', 3, true),
  ('m2-3-4-l-4', 'm2-3-4-l', '用角平分線性質解題', 'S04', '能由到角兩邊距離相等判斷在角平分線上；能用於證明與計算。', 4, true),
  ('m2-3-4-l-5', 'm2-3-4-l', '中垂線與角平分線綜合應用', 'S05', '能判斷題目需要用哪一條線的性質(到端點/到邊距離)並完成推理。', 5, true),
  ('m2-3-4-l-6', 'm2-3-4-l', '證明題中的應用', 'S06', '能把中垂線/角平分線作為關鍵輔助線，寫出理由與推論。', 6, true),

  -- 3-5 三角形的邊角關係
  ('m2-3-5-l-1', 'm2-3-5-l', '三邊關係(三角不等式)', 'S01', '理解兩邊和大於第三邊、兩邊差小於第三邊，作為三角形成立條件。', 1, true),
  ('m2-3-5-l-2', 'm2-3-5-l', '邊角大小對應', 'S02', '理解邊越長對角越大、角越大對邊越長；能建立對應關係。', 2, true),
  ('m2-3-5-l-3', 'm2-3-5-l', '用三邊關係判成立', 'S03', '能用三角不等式判斷三邊能否成三角形，會先排序邊長。', 3, true),
  ('m2-3-5-l-4', 'm2-3-5-l', '由邊推角大小', 'S04', '能依邊長大小推角大小並正確對應角。', 4, true),
  ('m2-3-5-l-5', 'm2-3-5-l', '由角推邊大小', 'S05', '能由角大小反推邊長大小，處理含未知數比較。', 5, true),
  ('m2-3-5-l-6', 'm2-3-5-l', '綜合應用與證明', 'S06', '能結合三邊關係與邊角關係做證明或排除不可能條件。', 6, true),

  -- 4-1 平行
  ('m2-4-1-l-1', 'm2-4-1-l', '平行線的意義', 'S01', '理解同一平面內不相交且距離處處相等；會用 l∥m 表示。', 1, true),
  ('m2-4-1-l-2', 'm2-4-1-l', '截線與截角概念', 'S02', '理解截線與兩直線相交形成對應角、內錯角、同側內角等角型，能辨認截線。', 2, true),
  ('m2-4-1-l-3', 'm2-4-1-l', '平行線的截角性質', 'S03', '會用對應角相等、內錯角相等、同側內角互補等性質解角度。', 3, true),
  ('m2-4-1-l-4', 'm2-4-1-l', '平行線的判別', 'S04', '能用角型相等/互補反推兩線平行(如內錯角相等→平行)。', 4, true),
  ('m2-4-1-l-5', 'm2-4-1-l', '作平行線', 'S05', '能用尺規或已知角度作過點 P 且平行於已知直線的線，並說明依據(對應角/內錯角)。', 5, true),
  ('m2-4-1-l-6', 'm2-4-1-l', '平行線綜合應用', 'S06', '能在複合圖形中先標示平行，再結合三角形/四邊形角度關係解題。', 6, true),
  ('m2-4-1-l-7', 'm2-4-1-l', '平行線證明題', 'S07', '能以角度關係寫出完整證明：條件→角型→結論(平行)。', 7, true),

  -- 4-2 平行四邊形
  ('m2-4-2-l-1', 'm2-4-2-l', '平行四邊形的定義', 'S01', '理解平行四邊形為兩組對邊互相平行的四邊形；能辨認。', 1, true),
  ('m2-4-2-l-2', 'm2-4-2-l', '平行四邊形的性質', 'S02', '理解對邊等長、對角相等、連續內角互補、對角線互相平分等性質。', 2, true),
  ('m2-4-2-l-3', 'm2-4-2-l', '利用性質求邊角', 'S03', '能用對邊等長、對角相等、內角互補求未知邊長或角度，可結合代數。', 3, true),
  ('m2-4-2-l-4', 'm2-4-2-l', '平行四邊形的判別', 'S04', '能用：兩組對邊平行、兩組對邊等長、一組對邊平行且等長、對角線互相平分等判別。', 4, true),
  ('m2-4-2-l-5', 'm2-4-2-l', '作平行四邊形', 'S05', '能依給定邊角或對角線條件作圖並說明為何成立。', 5, true),
  ('m2-4-2-l-6', 'm2-4-2-l', '平行四邊形在複合圖形中的辨認', 'S06', '能在複合圖中找出平行四邊形並用性質/判別說明。', 6, true),
  ('m2-4-2-l-7', 'm2-4-2-l', '平行四邊形證明題', 'S07', '能用判別條件完成證明(例如對角線互相平分→平行四邊形)。', 7, true),

  -- 4-3 特殊四邊形的性質
  ('m2-4-3-l-1', 'm2-4-3-l', '特殊四邊形定義', 'S01', '能說出長方形(四直角)、菱形(四邊等長)、正方形(兼具長方形與菱形)、箏形(兩組鄰邊相等)、梯形(僅一組對邊平行)的定義。', 1, true),
  ('m2-4-3-l-2', 'm2-4-3-l', '性質比較(對角線、邊角)', 'S02', '能比較各特殊四邊形的性質：對邊平行/等長、對角、對角線(等長/垂直/互相平分)。', 2, true),
  ('m2-4-3-l-3', 'm2-4-3-l', '利用性質計算', 'S03', '能用各圖形性質求角度/邊長/對角線特徵並完成計算。', 3, true),
  ('m2-4-3-l-4', 'm2-4-3-l', '判別特殊四邊形', 'S04', '能由已知條件判別是長方形/菱形/正方形/箏形/梯形；能討論條件是否充分。', 4, true),
  ('m2-4-3-l-5', 'm2-4-3-l', '作特殊四邊形', 'S05', '能依給定條件作長方形/菱形/正方形/等腰梯形等並說明作圖依據。', 5, true),
  ('m2-4-3-l-6', 'm2-4-3-l', '包含關係與分類綜合', 'S06', '理解正方形⊂長方形⊂平行四邊形、正方形⊂菱形⊂平行四邊形等包含關係並能解釋。', 6, true),
  ('m2-4-3-l-7', 'm2-4-3-l', '梯形與等腰梯形應用', 'S07', '能辨認梯形的平行邊；理解等腰梯形的基本性質(腰等長、底角相等、對角線等長)。', 7, true)
ON CONFLICT (id) DO UPDATE SET
  chapter_id = EXCLUDED.chapter_id,
  name = EXCLUDED.name,
  code = EXCLUDED.code,
  description = EXCLUDED.description,
  sort_order = EXCLUDED.sort_order,
  is_active = EXCLUDED.is_active;

