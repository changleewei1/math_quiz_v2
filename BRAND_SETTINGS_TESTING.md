# 品牌設定功能測試指南

## 🧪 測試前準備

### 1. 執行資料庫腳本

在 Supabase SQL Editor 執行：

```sql
-- 執行 supabase/add_brand_settings.sql
-- 或直接複製檔案內容執行
```

### 2. 建立 Storage Bucket

1. 前往 Supabase Dashboard → Storage
2. 點擊 "New bucket"
3. 設定：
   - **Name**: `brand-assets`
   - **Public bucket**: ✅ 勾選
4. 點擊 "Create bucket"

### 3. 確認環境變數

確認 `.env.local` 中有 Supabase 設定：

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## ✅ 測試步驟

### 測試 1：後台品牌設定頁面訪問

1. **訪問品牌設定頁面**
   - URL: `http://localhost:3000/admin/brand`
   - **預期結果**：如果未登入，會自動導向 `/admin/login`

2. **登入後訪問**
   - 登入管理員帳號
   - 訪問 `/admin/brand`
   - **預期結果**：可以正常載入品牌設定頁面

### 測試 2：讀取現有設定

1. **載入設定**
   - 訪問 `/admin/brand`
   - **預期結果**：
     - 補習班名稱欄位顯示「名貫補習班」（或資料庫中的值）
     - Logo 預覽顯示目前的 Logo
     - 字型下拉選單顯示目前選擇的字型

### 測試 3：修改補習班名稱

1. **修改名稱**
   - 在「補習班名稱」欄位輸入新名稱（例如：「測試補習班」）
   - 點擊「儲存設定」
   - **預期結果**：
     - 顯示成功訊息：「品牌設定已更新！前台將立即套用新設定。」
     - 3 秒後訊息自動消失

2. **驗證前台更新**
   - 訪問首頁 `http://localhost:3000`
   - **預期結果**：
     - Header 區域顯示新的補習班名稱
     - 無需重新整理，設定立即生效

3. **驗證持久化**
   - 重新整理首頁
   - **預期結果**：補習班名稱仍然是最新設定

### 測試 4：上傳 Logo

1. **準備測試圖片**
   - 準備一個 PNG、JPEG、SVG 或 WebP 格式的圖片
   - 建議大小 < 5MB

2. **上傳 Logo**
   - 點擊「選擇並上傳 Logo」
   - 選擇圖片檔案
   - **預期結果**：
     - 顯示「上傳中...」
     - 上傳完成後顯示「Logo 上傳成功！」
     - Logo 預覽立即更新
     - 自動更新資料庫（無需再次點擊儲存）

3. **驗證前台更新**
   - 訪問首頁
   - **預期結果**：
     - Header 區域顯示新的 Logo
     - Logo 可以正常載入顯示

4. **測試錯誤處理**
   - 嘗試上傳過大的檔案（> 5MB）
   - **預期結果**：顯示錯誤訊息「檔案大小超過 5MB」
   - 嘗試上傳不支援的格式
   - **預期結果**：顯示錯誤訊息「不支援的檔案格式」

### 測試 5：變更字型

1. **選擇字型**
   - 在「前台字型」下拉選單選擇不同的字型
   - **預期結果**：
     - 下方顯示字型預覽
     - 預覽文字使用選擇的字型

2. **儲存並驗證**
   - 點擊「儲存設定」
   - 訪問首頁
   - **預期結果**：
     - 全站文字使用選擇的字型
     - 字型變更立即生效

### 測試 6：權限控制

1. **未登入訪問**
   - 登出管理員
   - 直接訪問 `/admin/brand`
   - **預期結果**：自動導向 `/admin/login`

2. **非管理員訪問**
   - 以學生或老師身份登入
   - 嘗試訪問 `/admin/brand`
   - **預期結果**：無法訪問（middleware 會阻擋）

### 測試 7：快取機制

1. **修改設定**
   - 在後台修改品牌設定
   - 立即訪問前台首頁
   - **預期結果**：設定立即生效（無需等待）

2. **重新整理**
   - 重新整理前台頁面
   - **預期結果**：設定仍然是最新的

## 🐛 常見問題排除

### 問題 1：無法載入品牌設定

**症狀**：後台頁面顯示「載入設定失敗」

**解決方法**：
1. 確認已執行 `supabase/add_brand_settings.sql`
2. 確認 Supabase 連線正常
3. 檢查瀏覽器控制台的錯誤訊息

### 問題 2：Logo 上傳失敗

**症狀**：上傳 Logo 時顯示錯誤

**解決方法**：
1. 確認已建立 `brand-assets` Storage bucket
2. 確認 bucket 設定為 Public
3. 檢查檔案大小是否超過 5MB
4. 檢查檔案格式是否支援

### 問題 3：前台未更新

**症狀**：修改設定後，前台仍顯示舊設定

**解決方法**：
1. 清除瀏覽器快取
2. 確認 API 返回的資料是否正確
3. 檢查瀏覽器控制台是否有錯誤
4. 嘗試硬重新整理（Ctrl+Shift+R 或 Cmd+Shift+R）

### 問題 4：字型未套用

**症狀**：選擇字型後，前台文字未變更

**解決方法**：
1. 確認字型的 `cssFamily` 值正確
2. 檢查 `app/layout.tsx` 是否正確套用 `fontFamily` style
3. 確認字型檔案（如果是自訂字型）已正確載入

## 📊 測試檢查清單

- [ ] 可以訪問 `/admin/brand` 頁面（需登入）
- [ ] 可以載入現有品牌設定
- [ ] 可以修改補習班名稱並儲存
- [ ] 修改後前台立即更新
- [ ] 可以上傳 Logo 並看到預覽
- [ ] Logo 上傳後前台立即更新
- [ ] 可以選擇字型並看到預覽
- [ ] 字型變更後前台全站套用
- [ ] 重新整理後設定仍存在
- [ ] 未登入無法訪問品牌設定頁面
- [ ] 檔案大小驗證正常
- [ ] 檔案格式驗證正常

## 🎯 驗收標準

所有測試項目都通過後，品牌設定功能即為完成：

✅ **後台功能**
- 可以編輯補習班名稱
- 可以上傳並更換 Logo
- 可以選擇字型

✅ **前台套用**
- 補習班名稱立即更新
- Logo 立即更新
- 字型全站套用

✅ **資料持久化**
- 設定儲存到資料庫
- 重新整理後設定仍存在

✅ **權限控制**
- 僅管理員可訪問品牌設定
- API 有適當的權限驗證


